import{r as g,a as v,c as a,b as l,F as n,f as m,t as p,e as u,o,g as w,v as U}from"./index-319772b9.js";import{a as x}from"./axios-aba6f0e0.js";const C=l("h1",{class:"text-[20px] mx-[20px]"},"MJ",-1),T={class:"w-full flex m-[20px]"},j={class:"flex w-[300px]"},q=["onClick"],$=["onUpdate:modelValue"],B={key:0,class:"w-[80px] bg-slate-500 text-white"},E=["onClick"],G={key:0,class:"flex"},L={class:"relative"},M=["src"],R=["onClick"],S={key:0,style:{color:"red"}},N={__name:"index",setup(V){g();const r=v({prompt:"",taskid:"",imgUrl:"",imgUrls:[],time:1e4,message:"",baseImg:"",load:!1,promptGroup:[{queryTimer:null,baseImg:"",prompt:"",taskid:"",imgUrls:[],message:"",load:!1}]});async function h(e){if(e.message="",!e.prompt)return;const s={notifyHook:"",base64:e.baseImg,prompt:e.prompt,state:""},t=await x.create({baseURL:"https://mj.yklinga.ltd/apis"}).post("/mj/submit/imagine",s,{headers:{Accept:"application/json"}}).catch(c=>{console.log(c,"iserror")});console.log(t,"from mj java"),t.data.code===1&&(e.load=!0,e.taskid=t.data.result,d(e))}function d(e){e.taskid&&_(e.taskid).then(s=>{if(s.data.status==="FAILURE"){clearTimeout(e.queryTimer),e.load=!1,e.message=`请求失败: ${s.data.failReason}`;return}s.data.status==="SUCCESS"?(clearTimeout(e.queryTimer),e.load=!1,e.imgUrls=s.data.imageUrls):e.queryTimer=setTimeout(()=>{d(e)},r.time)}).catch(s=>{console.log(s,"www")})}async function _(e){return x.create({baseURL:"https://mj.yklinga.ltd/apis"}).get(`/mj/task/${e}/fetch`).catch(s=>{console.log(s,"iserror")})}const f=e=>{var s=document.createElement("a");s.download=name||"ecommerce_resimg",s.href=e,s.click()},k=()=>{r.promptGroup.push({queryTimer:null,baseImg:"",prompt:"",taskid:"",imgUrls:[],message:"",load:!1})},b=e=>{r.promptGroup.splice(e,1)};return(e,s)=>(o(),a(n,null,[C,l("div",{class:"mt-[10px] mx-[20px]"},[l("span",{class:"bg-slate-500 text-white p-[5px] rounded-md cursor-pointer",onClick:k},"add list")]),(o(!0),a(n,null,m(r.promptGroup,(t,c)=>(o(),a("div",T,[l("div",j,[l("div",{class:"text-white bg-slate-500 px-[5px] flex items-center",onClick:i=>b(c)}," cut of "+p(c),9,q),w(l("textarea",{"onUpdate:modelValue":i=>t.prompt=i,placeholder:"propt",class:"border border-black w-[150px] h-[100px]"},null,8,$),[[U,t.prompt]]),t.load?(o(),a("button",B," load img ")):(o(),a("button",{key:1,class:"w-[80px] bg-slate-500 text-white",onClick:i=>h(t)}," submit ",8,E))]),t.imgUrls?(o(),a("div",G,[(o(!0),a(n,null,m(t.imgUrls,(i,y)=>(o(),a("div",L,[(o(),a("img",{key:y,class:"h-[100px] mr-[20px]",src:i,alt:""},null,8,M)),l("div",{class:"absolute bottom-[5px] right-[25px] text-white text-xs bg-slate-500 opacity-80 rounded-sm px-[5px] cursor-pointer",onClick:F=>f(i)}," 保存 ",8,R)]))),256))])):u("",!0)]))),256)),r.message?(o(),a("p",S,p(r.message),1)):u("",!0)],64))}};export{N as default};
