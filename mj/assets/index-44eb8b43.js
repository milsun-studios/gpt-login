import{r as h,a as x,c as a,b as r,e as i,f as y,v as k,F as g,g as b,t as U,o}from"./index-0f77b665.js";import{a as c}from"./axios-aba6f0e0.js";const j=r("h1",{class:"text-[30px] text-center"},"MJ",-1),v={class:"m-[50px] flex justify-center"},I=r("span",null,"垫图(可选): ",-1),R=["src"],L={class:"m-[50px] flex justify-center"},T={key:0,class:"mr-[50px]"},w={key:0,class:"flex mt-[50px]"},C=["src"],S={key:1,class:"flex justify-center mt-[50px]"},B=["src"],M={key:2,style:{color:"red"}},D={__name:"index",setup(E){const n=h(),e=x({prompt:"",taskid:"",imgUrl:"",imgUrls:[],time:1e4,message:"",baseImg:"",load:!1});async function p(){if(e.message="",!e.prompt)return;const t={notifyHook:"",base64:e.baseImg,prompt:e.prompt,state:""},s=await c.create({baseURL:"https://mj.yklinga.ltd/apis"}).post("/mj/submit/imagine",t,{headers:{Accept:"application/json"}}).catch(l=>{console.log(l,"iserror")});console.log(s,"from mj java"),s.data.code===1&&(e.load=!0,e.taskid=s.data.result,m())}function m(){e.taskid&&d().then(t=>{if(t.data.status==="FAILURE"){clearTimeout(n.value),e.load=!1,e.message=`请求失败: ${t.data.failReason}`;return}t.data.status==="IN_PROGRESS"&&(e.imgUrl=t.data.imageUrl),t.data.status==="SUCCESS"?(clearTimeout(n.value),e.load=!1,e.imgUrls=t.data.imageUrls):n.value=setTimeout(()=>{m()},e.time)}).catch(t=>{console.log(t,"www")})}async function d(){return c.create({baseURL:"https://mj.yklinga.ltd/apis"}).get(`/mj/task/${e.taskid}/fetch`).catch(t=>{console.log(t,"iserror")})}async function u(){return c.create({baseURL:"https://mj.yklinga.ltd/apis"}).get("/mj/task/list").catch(t=>{console.log(t,"iserror")})}function f(t){console.log(t);var s=new FileReader;s.readAsDataURL(t.target.files[0]),s.onload=function(l){e.baseImg=l.currentTarget.result}}return(t,s)=>(o(),a(g,null,[j,r("div",v,[r("div",null,[I,r("input",{type:"file",accept:"image/png, image/jpeg, image/gif, image/jpg",onChange:f},null,32)]),e.baseImg?(o(),a("img",{key:0,class:"w-[100px] h-[100px]",src:e.baseImg,alt:""},null,8,R)):i("",!0)]),r("div",L,[y(r("textarea",{"onUpdate:modelValue":s[0]||(s[0]=l=>e.prompt=l),placeholder:"propt",class:"border border-black mr-[50px]"},null,512),[[k,e.prompt]]),e.load?(o(),a("button",T,"load img...")):(o(),a("button",{key:1,class:"mr-[50px]",onClick:p},"submit")),r("button",{onClick:u},"getTaskList")]),e.imgUrl&&!e.imgUrls.length?(o(),a("div",w,[r("img",{crossorigin:"anonymous",src:e.imgUrl,alt:""},null,8,C)])):i("",!0),e.imgUrls?(o(),a("div",S,[(o(!0),a(g,null,b(e.imgUrls,(l,_)=>(o(),a("img",{key:_,class:"w-[100px] h-[100px] mr-[20px]",src:l,alt:""},null,8,B))),128))])):i("",!0),e.message?(o(),a("p",M,U(e.message),1)):i("",!0)],64))}};export{D as default};
