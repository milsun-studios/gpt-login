import{r as x,a as f,c as a,b as o,f as U,v as h,e as l,F as p,g as k,t as y,o as r}from"./index-9f730a7f.js";import{a as n}from"./axios-aba6f0e0.js";const b=o("h1",{class:"text-[30px] text-center"},"MJ",-1),v={class:"m-[50px]"},A={key:0,class:"flex mt-[50px]"},P=["src"],R={key:1,class:"flex mt-[50px]"},L=["src"],T={key:2,style:{color:"red"}},E={__name:"index",setup(j){const c=x(),t=f({prompt:"",taskid:"",imgUrl:"",imgUrls:[],time:1e4,message:""});async function u(){if(t.message="",!t.prompt)return;const e={notifyHook:"",prompt:t.prompt,state:""},s=await n.create({baseURL:{}.VITE_APP_API_DRAW_URL}).post("/mj/submit/imagine",e,{headers:{Accept:"application/json"}}).catch(i=>{console.log(i,"iserror")});console.log(s,"from mj java"),s.data.code===1&&(t.taskid=s.data.result,m())}function m(){t.taskid&&d().then(e=>{if(e.data.status==="FAILURE"){clearTimeout(c.value),t.message=`请求失败: ${e.data.failReason}`;return}t.imgUrl=e.data.imgUrl,e.data.status==="SUCCESS"?(clearTimeout(c.value),t.imgUrls=e.data.imageUrls):c.value=setTimeout(()=>{m()},t.time)}).catch(e=>{console.log(e,"www")})}async function d(){return n.create({baseURL:{}.VITE_APP_API_DRAW_URL}).get(`/mj/task/${t.taskid}/fetch`).catch(e=>{console.log(e,"iserror")})}async function g(){return n.create({baseURL:{}.VITE_APP_API_DRAW_URL}).get("/mj/task/list").catch(e=>{console.log(e,"iserror")})}return(e,s)=>(r(),a(p,null,[b,o("div",v,[U(o("textarea",{"onUpdate:modelValue":s[0]||(s[0]=i=>t.prompt=i),placeholder:"propt",class:"w-[200px] border border-black mr-[50px]"},null,512),[[h,t.prompt]]),o("button",{class:"mr-[50px]",onClick:u},"submit"),o("button",{onClick:g},"getTaskList"),t.imgUrl&&!t.imgUrls?(r(),a("div",A,[o("img",{src:t.imgUrl,alt:""},null,8,P)])):l("",!0),t.imgUrls?(r(),a("div",R,[(r(!0),a(p,null,k(t.imgUrls,(i,_)=>(r(),a("img",{key:_,class:"w-[200px] h-[200px] mr-[20px]",src:i,alt:""},null,8,L))),128))])):l("",!0),t.message?(r(),a("p",T,y(t.message),1)):l("",!0)])],64))}};export{E as default};
